{% extends 'feincmsforum/base.html' %}
{% load i18n forum_extras applicationcontent_tags fragment_tags %}

{% block bbcontent %}

{% fragment request "extrabreadcrumbs" %}
<li>&raquo; <a href="{{ topic.forum.get_absolute_url }}">{{ topic.forum.name }}</a></li>
<li class="selected">&raquo; {{ topic.name }}</li>
{% endfragment %}

{% fragment request "title" %}{{ topic.forum.name }} / {{ topic.name }}{% endfragment %}
{% fragment request "keywords" %}{{ topic.name }}{% endfragment %}
{% fragment request "description" %}{{ topic.posts.0 }}{% endfragment %}

<div class="right">
  <ul class="rhorizList">
	<li><a href="{% url djangobb:forum_topic_feed topic.id %}" class="icon rss"></a></li>
	{% if not topic.closed and user.is_authenticated %}
	<li><a href="{% url djangobb:add_post topic.forum.id topic.id %}" class="form-submit">
		{% trans "Reply" %}</a></li>
	{% endif %}
	{% if user.is_authenticated %}
		{% if subscribed %}
	<li><a href="{% url djangobb:forum_delete_subscription topic.id %}?from_topic" 
		class="form-submit">{% trans "Unsubscribe" %}</a>
		{% else %}
	<li><a href="{% url djangobb:forum_add_subscription topic.id %}" 
		class="form-submit">{% trans "Subscribe" %}</a></li>
		{% endif %}
	{% endif %}
  </ul>
</div>

<h1>{{ topic.name }}</h1>

<div>{% pagination %}</div>	

{% for post in posts %}
<div id="p{{ post.id }}" class="blockpost">
	<a name="post-{{ post.id }}"></a>
	<div class="categoryhead headlighted">
		<span class="right">#{{ forloop.counter }}</span>
		{% forum_time post.created %}
	</div>
	<div class="box">
	
	  {% include 'feincmsforum/includes/post_info.html' %}
		
	  <div class="postmsg">
		{{ post.body_html|safe }}
		{% if not user.is_authenticated or user.forum_profile.show_signatures %}
			{% if post.user.forum_profile.signature %}
			<div class="postsignature">
				{{ post.user.forum_profile.signature|safe }}
			</div>
			{% endif %}
		{% endif %}
		
		{% if post.updated %}
			<div class="postedit">{% trans "Edited" %} {{ post.updated_by.username }}
			({% forum_time post.updated %})</p>
		{% endif %}
	  </div>
		
	  <div class="postfootright">
		<ul class="submit">
			<li class="postreport">
				{% app_reverse "report" "feincmsforum.urls" post.id as postURL %}
				<a href="{{ postURL }}">{% trans "Report" %}</a>
			</li>
			{% if moderator or post|forum_equal_to:last_post %}
				{% if moderator or post.user|forum_equal_to:user %}
			<li class="postdelete">
			  <a onclick="return confirm('{% trans "Are you sure you want to delete this post?" %}')" 
			  	href="{% url djangobb:delete_post post.id %}">
			  	  {% trans "Delete" %}</a>
			</li>
				{% endif %}
			{% endif %}
			
			<li class="postquote">
			  <a href="{% url djangobb:add_post topic.forum.id topic.id %}?post_id={{ post.id }}">{% trans "Reply" %}</a>
			</li>
			
			{% comment %}
			{% if moderator or post|forum_posted_by:user %}
			<li class="postedit">
			  <a href="{% url djangobb:edit_post post.id %}">{% trans "Edit" %}</a>
			</li>
			{% endif %}
			
			{% if user.is_authenticated %}
			<li class="postquote">
			  <a onmouseover="copyQ('{{ post.user.username }}');" href="javascript:pasteQ();">
			  	{% trans "Quote" %}</a>
			</li>
			{% endif %}
			{% endcomment %}
		</ul>
	  </div>
		
	  <div class="clearer"></div>
	</div>
</div>
{% endfor %}
<div>{% pagination %}</div>

{% if not topic.closed and user.is_authenticated %}
<h4>{% trans "Quick post" %}</h4>
<form id="post" class="blockform" method="post"
	action="{% url djangobb:add_post topic.forum.id topic.id %}" >
	{% csrf_token %}
	{{ form.body }}
	
	<p class="submit">
		<input type="submit" value="{% trans "Submit" %}" />
	</p>
</form>
{% endif %}

<div class="conl">
	<form id="qjump" method="get" action="forum">
		<div><label>{% trans "Jump to " %}
		<select name="id" id="forum_id" onchange="window.location=('{% url djangobb:index %}'+this.options[this.selectedIndex].value)">
			{% for category in categories %}
				<optgroup label="{{ category }}">
					{% for forum in category.forums.all %}
						<option value="{{ forum.id }}">{{ forum }}</option>
					{% endfor %}
				</optgroup>
			{% endfor %}
		</select>
		<input type="button" onclick="window.location=('{% url djangobb:index %}'+getElementById('forum_id').value)" value=" {% trans "Go" %} " accesskey="g" />
		</label></div>
	</form>
	{% if moderator %}
		<dl id="modcontrols">
			<dt>{% trans "Moderator control" %}</dt>
			<dd><a href="{% url djangobb:move_topic %}?topic_id={{ topic.id }}">{% trans "Move topic" %}</a></dd>
		{% if topic.closed %}
			<dd><a href="{% url djangobb:open_close_topic topic.id 'o' %}">{% trans "Open topic" %}</a></dd>
		{% else %}
			<dd><a href="{% url djangobb:open_close_topic topic.id 'c' %}">{% trans "Close topic" %}</a></dd>
		{% endif %}
		{% if topic.sticky %}
			<dd><a href="{% url djangobb:stick_unstick_topic topic.id 'u' %}">{% trans "Unstick topic" %}</a></dd>
		{% else %}
			<dd><a href="{% url djangobb:stick_unstick_topic topic.id 's' %}">{% trans "Stick topic" %}</a></dd>
		{% endif %}
		</dl>
	{% endif %}
</div>
{% endblock %}